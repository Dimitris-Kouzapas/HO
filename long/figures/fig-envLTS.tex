\begin{figure}
	\[
	\begin{array}{c}
		\eltsrule{SOut}~~\tree{
			\begin{array}{c}
				\dual{n} \notin \dom{\Delta}
				\qquad 
				\Gamma \cat \Gamma'; \Lambda'; \Delta_1 \cat \Delta_2 \proves V \hastype U
				\qquad
				\Lambda' \subseteq \Lambda
				\qquad
				\Delta_1 \subseteq \Delta\\
				a \in \tilde{m} \Leftrightarrow a: \chtype{U'} \in \Gamma' \quad
				s_i \in \tilde{m} \Leftrightarrow (s_i: S_i \in \Delta_2 \wedge \dual{s_i}: S'_i \in \Delta_3 \wedge S_i \dualof S'_i)
			\end{array}
		}{
			(\Gamma; \Lambda; \Delta \cat n: \btout{U} S) \by{\news{\tilde{m}} \bactout{n}{V}} (\Gamma \cat \Gamma'; \Lambda\backslash\Lambda'; (\Delta\backslash\Delta_1) \cat \Delta_3 \cat n: S)			
		}
		\\[8mm]

		\eltsrule{ShOut}~~\tree{
			\begin{array}{c}
				\Gamma \cat \Gamma' \cat a: \chtype{U}; \Lambda'; \Delta_1 \cat \Delta_2 \proves V \hastype U
				\qquad
				\Lambda' \subseteq \Lambda
				\qquad
				\Delta_1 \subseteq \Delta\\
				b \in \tilde{m} \Leftrightarrow b: \chtype{U'} \in \Gamma \quad
				s \in \tilde{m} \Leftrightarrow (s_i: S_i \in \Delta_2 \wedge \dual{s_i}: S'_i \in \Delta_3 \wedge S_i \dualof S'_i)
			\end{array}
		}{
			(\Gamma\cat a: \chtype{U}; \Lambda; \Delta) \by{\news{\tilde{m}} \bactout{a}{V}} (\Gamma \cat \Gamma'\cat a: \chtype{U}; \Lambda\backslash\Lambda'; (\Delta\backslash\Delta_1) \cat \Delta_3)			
		}
		\\[8mm]


		\eltsrule{SRecv}~~\tree{
			\dual{n} \notin \dom{\Delta} \quad \Gamma; \Lambda'; \Delta' \proves V \hastype U
		}{
			(\Gamma; \Lambda; \Delta \cat n: \btinp{U} S) \by{\bactinp{n}{V}} (\Gamma; \Lambda\cat\Lambda'; \Delta\cat\Delta' \cat n: S)
		}
		\\[8mm]

		\eltsrule{ShRecv}~~\tree{
			\Gamma; \es; \es \proves a \hastype \chtype{U}
			\quad
			\Gamma; \Lambda'; \Delta' \proves V \hastype U
		}{
			(\Gamma; \Lambda; \Delta) \by{\bactinp{a}{\tilde{V}}} (\Gamma; \Lambda\cat\Lambda'; \Delta\cat\Delta')
		}
		\\[8mm]

		\tree{
			\dual{n} \notin \dom{\Delta} \quad j \in I
		}{
			(\Gamma; \Lambda; \Delta \cat n: \btsel{l_i: S_i}_{i \in I}) \by{\bactsel{n}{l_j}} (\Gamma; \Lambda; \Delta \cat n:S_j)
		}
		\qquad
		\tree{
			\dual{n} \notin \dom{\Delta} \quad j \in I
		}{
			(\Gamma; \Lambda; \Delta \cat n: \btbra{l_i: T_i}_{i \in I}) \by{\bactbra{n}{l_j}} (\Gamma; \Lambda; \Delta \cat n:S_j)
		}
		\\[8mm]

		\tree{
			\Delta_1 \red \Delta_2
		}{
			(\Gamma; \Lambda; \Delta_1) \by{\tau} (\Gamma; \Lambda; \Delta_2)
		}

		\vspace{12mm}\\

		\tree{
			U = \lhot{\tilde{C}} \vee U = \shot{\tilde{C}}
			\quad
			(\Gamma_1; \Lambda_1; \Delta_1) \by{\bactinp{n}{\abs{\tilde{x}}{\map{U}^{\tilde{x}}}}} (\Gamma_2; \Lambda_2; \Delta_2)
		}{
			(\Gamma_1; \Lambda_1; \Delta_1) \hby{\bactinp{n}{\abs{\tilde{x}}{\map{U}^{\tilde{x}}}}} (\Gamma_2; \Lambda_1; \Delta_2)
		}
		\\[6mm]

		\tree{
%			\dual{n},
			\dual{t} \notin \dom{\Delta}
%			\quad
%			(\Gamma_1; \Lambda_1; \Delta_1 \cat n: \btinp{\lhot{C}} S) \by{\bactinp{n}{\abs{x}{\binp{t}{X} \appl{X}{x}}}} (\Gamma_2; \Lambda_2; \Delta_1 \cat n: S \cat t: \btinp{\lhot{C}} \tinact)			
		}{
			(\Gamma; \Lambda; \Delta \cat n: \btinp{\lhot{\tilde{C}}} S) \hby{\bactinp{n}{\abs{\tilde{x}}{\binp{t}{X} \appl{X}{\tilde{x}}}}} (\Gamma; \Lambda; \Delta \cat n: S \cat t: \btinp{\lhot{\tilde{C}}} \tinact)
		}
		\\[6mm]

%		\tree{
%			U = \lhot{C} \vee U = \shot{C}
%		}{
%			(\Gamma \cat a: \chtype{U}; \Lambda; \Delta) \hby{\bactinp{a}{\abs{x}{\map{C}^x}}} (\Gamma \cat a: \chtype{U}; \Lambda; \Delta)
%		}
%		\\[6mm]

		\tree{
			\dual{t} \notin \dom{\Delta}
		}{
		(\Gamma \cat a: \chtype{\lhot{\tilde{C}}}; \Lambda; \Delta) \hby{\bactinp{a}{\abs{\tilde{x}}{\binp{t}{X} \appl{X}{\tilde{x}}}}} (\Gamma \cat a: \chtype{\lhot{\tilde{C}}}; \Lambda; \Delta \cat t: \btinp{\lhot{\tilde{C}}}
 \tinact)
		}
		\\[6mm]

		\tree{
			\dual{n} \notin \dom{\Delta} \quad t \notin \dom{\Gamma}
		}{
			(\Gamma; \Lambda; \Delta \cat n: \btinp{\shot{\tilde{C}}} S) \hby{\bactinp{n}{\abs{\tilde{x}}{\binp{t}{X} \appl{X}{\tilde{x}}}}} (\Gamma \cat t: \chtype{\lhot{\tilde{C}}}; \Lambda; \Delta \cat n: S)
		}
		\\[6mm]
		\tree{
			t \notin \dom{\Gamma}
		}{
			(\Gamma \cat a: \chtype{\shot{\tilde{C}}}; \Lambda; \Delta) \hby{\bactinp{a}{\abs{\tilde{x}}{\binp{t}{X} \appl{X}{\tilde{x}}}}} (\Gamma \cat a: \chtype{\shot{\tilde{C}}} \cat t: \chtype{\lhot{\tilde{C}}}; \Lambda; \Delta)
		}
		\\[6mm]
	\end{array}
	\]
	\caption{Labelled Transition Semantics for Typed Enviroments \label{fig:envLTS}}
\end{figure}
