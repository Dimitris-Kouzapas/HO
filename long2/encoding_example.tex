\begin{example}[Encode $\recp{X}{\bout{a}{m} \varp{X}}$ into \HO]

\noi {\bf Mapping:} Term mapping of \HOp process $\recp{X}{\bout{a}{m} \varp{X}}$
into a \HO process. We note initially $f = \emptyset$. The first application of the mapping
will give:
%
\[
\begin{array}{rcl}
	\pmapp{\recp{X}{\bout{a}{m} \varp{X}}}{1}{} &=&
	\newsp{s_1}{ \binp{s_1}{x} \pmapp{\bout{a}{m} \varp{X}}{1}{\varp{X} \rightarrow x_ax_m} \Par\\
	&&\bout{\dual{s_1}}{ \abs{(x_a, x_m, z)} \binp{z}{x} \auxmap{\pmapp{\bout{a}{m} \varp{X}}{1}{\varp{X} \rightarrow x_ax_m}}{\es} } \inact}
	\\
	\multicolumn{3}{l}{\textrm{with}}
	\\
	\pmapp{\bout{a}{m} \varp{X}}{1}{ \varp{X} \rightarrow x_ax_m} &=&
	\bout{a}{\abs{z}{\binp{z}{x} (\appl{x}{m})}} \pmapp{\varp{X}}{1}{\varp{X} \rightarrow x_ax_m}
	\\
	&=& \bout{a}{\abs{z}{\binp{z}{x} (\appl{x}{m})}} \newsp{s_2}{\appl{x}{(a,m, s_2)}  \Par \bout{\dual{s_2}}{\abs{(x_a, x_m, z)}{\appl{x}{(x_a, x_m, z)}}} \inact}
\end{array}
\]
%
\noi Furthermore:
%
\[
\begin{array}{l}
	\auxmap{\pmapp{\bout{a}{m} \varp{X}}{1}{\varp{X} \rightarrow x_ax_m}}{\es}\\
	\qquad \qquad \quad = \auxmap{\bout{a}{\abs{z}{\binp{z}{x} (\appl{x}{m})}} \newsp{s_2}{\appl{x}{(a,m, s_2)}  \Par \bout{\dual{s_2}}{\abs{(x_a, x_m, z)}{\appl{x}{(x_a, x_m, z)}}} \inact}}{\es}
	\\
	\qquad \qquad \quad = \bout{x_a}{\abs{z}{\binp{z}{x} (\appl{x}{x_m})}} \auxmap{\newsp{s_2}{\appl{x}{(a,m, s_2)}  \Par \bout{\dual{s_2}}{\abs{(x_a, x_m, z)}{\appl{x}{(x_a, x_m, z)}}} \inact}}{\es}
	\\
	\qquad \qquad \quad = \bout{x_a}{\abs{z}{\binp{z}{x} (\appl{x}{x_m})}} \newsp{s_2}{\appl{x}{(x_a,x_m, s_2)}  \Par \bout{\dual{s_2}}{\abs{(x_a, x_m, z)}{\appl{x}{(x_a, x_m, z)}}} \inact}
\end{array}
\]
%
\noi The whole encoding would be:
%
\[
\begin{array}{l}
	V = \abs{(x_a, x_m, z)} \binp{z}{x} \bout{x_a}{\abs{z}{\binp{z}{x} (\appl{x}{x_m})}} \newsp{s_2}{\appl{x}{(x_a,x_m, s_2)}  \Par \bout{\dual{s_2}}{\abs{(x_a, x_m, z)}{\appl{x}{(x_a, x_m, z)}}} \inact}\\
	\pmapp{\recp{X}{\bout{a}{m} \varp{X}}}{1}{} \scong \\
	\newsp{s_1}{\bout{\dual{s_1}}{V} \inact \Par \binp{s_1}{x} \bout{a}{\abs{z}{\binp{z}{x} (\appl{x}{m})}} \newsp{s_2}{\bout{\dual{s_2}}{\abs{(x_a, x_m, z)}{\appl{x}{(x_a, x_m, z)}}} \inact} \Par \appl{x}{(a,m, s_2)}}
\end{array}
\]

\noi {\bf Transition Semantics:} We can observe $\pmapp{\recp{X}{\bout{a}{m} \varp{X}}}{1}{}$ as:
\[
	\begin{array}{l}
		\pmapp{\recp{X}{\bout{a}{m} \varp{X}}}{1}{}\\
		\scong
		\\
		\newsp{s_1}{\bout{\dual{s_1}}{V} \inact \Par \binp{s_1}{x} \bout{a}{\abs{z}{\binp{z}{x} (\appl{x}{m})}} \newsp{s_2}{\bout{\dual{s_2}}{\abs{(x_a, x_m, z)}{\appl{x}{(x_a, x_m, z)}}} \inact} \Par \appl{x}{(a,m, s_2)}}
		\\
		\by{\tau}
		\\
		\bout{a}{\abs{z}{\binp{z}{x} (\appl{x}{m})}}\\
		\newsp{s_2}{\bout{\dual{s_2}}{V} \inact \Par \binp{s_2}{x} \bout{a}{\abs{z}{\binp{z}{x} (\appl{x}{m})}} \newsp{s_3}{\bout{\dual{s_3}}{\abs{(x_a, x_m, z)}{\appl{x}{(x_a, x_m, z)}}} \inact} \Par \appl{x}{(a,m, s_3)}}
		\\
		\scong_{\alpha}
		\\
		\bout{a}{\abs{z}{\binp{z}{x} (\appl{x}{m})}}\\
		\newsp{s_1}{\bout{\dual{s_1}}{V} \inact \Par \binp{s_1}{x} \bout{a}{\abs{z}{\binp{z}{x} (\appl{x}{m})}} \newsp{s_2}{\bout{\dual{s_2}}{\abs{(x_a, x_m, z)}{\appl{x}{(x_a, x_m, z)}}} \inact} \Par \appl{x}{(a,m, s_2)}}
		\\
		\scong
		\\
		\bout{a}{\abs{z}{\binp{z}{x} (\appl{x}{m})}} \pmapp{\recp{X}{\bout{a}{m} \varp{X}}}{1}{}
		\\
		\by{\bactout{a}{\abs{z}{\binp{z}{x} (\appl{x}{m})}}}
		\\
		\pmapp{\recp{X}{\bout{a}{m} \varp{X}}}{1}{}
	\end{array}
\]
%
\noi {\bf Typing Semantics:} We further show that $\pmapp{\recp{X}{\bout{a}{m} \varp{X}}}{1}{}$ is typable:
\begin{eqnarray}
	\tree{
		\begin{array}{l}
			\Gamma; \es; \es \proves a \hastype U_1 = \chtype{\lhot{\btinp{\lhot{U_2}} \tinact}} \\
			\Gamma; \es; \es \proves m \hastype U_2\\
			\Gamma; \es; s_2: \proves s_2 : \btinp{L} \tinact \proves s_2 \hastype \btinp{L} \tinact\\ 
			\Gamma; \es; \es \proves x \hastype \shot{(U_1, U_2, \btinp{L} \tinact)}
		\end{array}
	}{
		\Gamma; \es; s_2 : \btinp{L} \tinact \proves \appl{x}{(a,m, s_2)} \hastype \Proc
	}
	\label{ex:type1}
\end{eqnarray}
%
\begin{eqnarray}
	\tree{
		\tree{
			\begin{array}{l}
				\Gamma \cat x_a: U_1 \cat x_m: U_2; \es; \es \proves x_a \hastype U_1 = \chtype{\lhot{\btinp{\lhot{U_2}} \tinact}} \\
				\Gamma \cat x_a: U_1 \cat x_m: U_2 ; \es; \es \proves x_m \hastype U_2\\
				\Gamma; \es; z: \btinp{L} \tinact \proves z \hastype \btinp{L} \tinact\\
				\Gamma; \es; \es \proves x \hastype \shot{(U_1, U_2, \btinp{L} \tinact)}
			\end{array}
		}{
			\Gamma \cat x_a: U_1 \cat x_m: U_2 ; \es; z: \btinp{L} \tinact \proves \appl{x}{(x_a, x_m, z)} \hastype \Proc
		}
	}{
		\Gamma; \es; \es \proves \abs{(x_a, x_m, z)}{\appl{x}{(x_a, x_m, z)}} \hastype \shot{(U_1, U_2, \btinp{L} \tinact)}
	}
	\label{ex:type2}
\end{eqnarray}
%
\begin{eqnarray}
	\tree{
		\begin{array}{ll}
			\textrm{Result}~\eqref{ex:type2}
			\\
			\Gamma; \es; \dual{s_2} : \btout{\shot{(U_1, U_2, \btinp{L} \tinact)}} \tinact \proves \dual{s_2} \hastype \btout{\shot{(U_1, U_2, \btinp{L} \tinact)}} \tinact
		\end{array}
	}{
		\Gamma; \es; \dual{s_2} : \btout{\shot{(U_1, U_2, \btinp{L} \tinact)}} \tinact \proves \bout{\dual{s_2}}{\abs{(x_a, x_m, z)}{\appl{x}{(x_a, x_m, z)}}} \inact \hastype \Proc
	}
	\label{ex:type25}
\end{eqnarray}
%
\begin{eqnarray}
	\tree{
		\textrm{Result}~\eqref{ex:type1}
		\quad
		\textrm{Result}~\eqref{ex:type25}
		\quad
		\Delta = s_2: \btinp{L} \tinact \cat \dual{s_2}: \btout{\shot{(U_1, U_2, \btinp{L} \tinact)}} \tinact
	}{
		\Gamma; \es; \Delta \proves \bout{\dual{s_2}}{\abs{(x_a, x_m, z)}{\appl{x}{(x_a, x_m, z)}}} \inact \Par \appl{x}{(a,m, s_2)} \hastype \Proc
	}
	\label{ex:type3}
\end{eqnarray}
%
\begin{eqnarray}
	\tree{
		\begin{array}{l}
			\textrm{Result}~\eqref{ex:type3}
			\quad
			\btinp{L} \tinact \dualof \btout{\shot{(U_1, U_2, \btinp{L} \tinact)}} \tinact\\
			L = \shot{(U_1, U_2, \btinp{L} \tinact)} \textrm{ implies }\\
			\btinp{L} \tinact = \trec{t}{\btinp{\shot{(U_1, U_2, \vart{t})}} \tinact}
		\end{array}
	}{
		\Gamma; \es; \es \proves \newsp{s_2}{\bout{\dual{s_2}}{\abs{(x_a, x_m, z)}{\appl{x}{(x_a, x_m, z)}}} \inact \Par \appl{x}{(a,m, s_2)} \hastype \Proc}
	}
	\label{ex:type4}
\end{eqnarray}
%
\begin{eqnarray}
	\tree{
		\begin{array}{l}
			\textrm{Result}~\eqref{ex:type4}
			\\
			\Gamma; \es; \es \proves a \hastype \chtype{\lhot{\btinp{\lhot{U_2}} \tinact}}
			\\
			\Gamma; \es; \es \proves \abs{z}{\binp{z}{x} (\appl{x}{m})} \hastype \lhot{\btinp{\lhot{U_2}} \tinact}
		\end{array}
	}{
		\Gamma; \es; \es \proves \bout{a}{\abs{z}{\binp{z}{x} (\appl{x}{m})}} \newsp{s_2}{\bout{\dual{s_2}}{\abs{(x_a, x_m, z)}{\appl{x}{(x_a, x_m, z)}}} \inact \Par \appl{x}{(a,m, s_2)}} \hastype \Proc
	}
	\label{ex:type5}
\end{eqnarray}
%
\begin{eqnarray}
	\tree{
		\begin{array}{l}
			\textrm{Result}~\eqref{ex:type5}
			\quad
			\Gamma' = \Gamma \backslash x
			\\
			\Gamma; \es; \es \proves x \hastype \shot{(U_1, U_2, \trec{t}{\btinp{\shot{(U_1, U_2, t)}} \tinact})}
			\\
			\Gamma'; \es; \Delta \proves s_1 \hastype \btinp{\shot{(U_1, U_2, \trec{t}{\btinp{\shot{(U_1, U_2, \vart{t})}} \tinact})}} \tinact
		\end{array}
	}{
		\begin{array}{l}
			\Gamma'; \es; \Delta_1 \proves
			\\
			\quad\ \binp{s_1}{x} \bout{a}{\abs{z}{\binp{z}{x} (\appl{x}{m})}} \newsp{s_2}{\bout{\dual{s_2}}{\abs{(x_a, x_m, z)}{\appl{x}{(x_a, x_m, z)}}} \inact \Par \appl{x}{(a,m, s_2)}} \hastype \Proc
		\end{array}
	}
	\label{ex:type6}
\end{eqnarray}
%
\begin{eqnarray}
	\tree{
		\begin{array}{rcl}
			V &=& \abs{(x_a, x_m, z)} \binp{z}{x} \bout{x_a}{\abs{z}{\binp{z}{x} (\appl{x}{x_m})}}\\
			&& \newsp{s_2}{\appl{x}{(x_a,x_m, s_2)}  \Par \bout{\dual{s_2}}{\abs{(x_a, x_m, z)}{\appl{x}{(x_a, x_m, z)}}} \inact}
			\\
			\multicolumn{3}{l}{
				\Gamma'; \es; \es \proves V \hastype \shot{(U_1, U_2, \trec{t}{\btinp{\shot{(U_1, U_2, \vart{t})}} \tinact})}
			}
			\\
			\multicolumn{3}{l}{
				\Gamma'; \es; \Delta_2 \proves \dual{s_1} \hastype \btout{\shot{(U_1, U_2, \trec{t}{\btinp{\shot{(U_1, U_2, t)}} \tinact})}} \tinact
			}
		\end{array}
	}{
		\Gamma'; \es; \Delta_2 \proves \bout{\dual{s_1}}{V} \inact \hastype \Proc
	}
	\label{ex:type7}
\end{eqnarray}
%
\begin{eqnarray*}
	\tree{
		\tree{
			\textrm{Result}~\eqref{ex:type6} \quad \textrm{Result}~\eqref{ex:type7}
		}{
			\begin{array}{rcl}
				\Gamma; \es; \Delta_1 \cat \Delta_2 &\proves& \bout{\dual{s_1}}{V} \inact \Par \binp{s_1}{x} \bout{a}{\abs{z}{\binp{z}{x} (\appl{x}{m})}}\\
				&&\newsp{s_2}{\bout{\dual{s_2}}{\abs{(x_a, x_m, z)}{\appl{x}{(x_a, x_m, z)}}} \inact} \Par \appl{x}{(a,m, s_2)} \hastype \Proc
			\end{array}
		}
	}{
		\begin{array}{rcl}
			\Gamma; \es; \es &\proves& \newsp{s_1}{\bout{\dual{s_1}}{V} \inact \Par \binp{s_1}{x} \bout{a}{\abs{z}{\binp{z}{x} (\appl{x}{m})}}\\
			&&\newsp{s_2}{\bout{\dual{s_2}}{\abs{(x_a, x_m, z)}{\appl{x}{(x_a, x_m, z)}}} \inact} \Par \appl{x}{(a,m, s_2)}} \hastype \Proc
		\end{array}
	}
\end{eqnarray*}
\qed
\end{example}

