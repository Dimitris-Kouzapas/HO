% !TEX root = main.tex
\jparagraph{Precise Encodings of $\HOpp$ and $\PHOp$ into $\HOp$}
\noi We give  %two extensions of \HOp: 
encodings of \HOpp into \HOp
and into \PHOp, and show that they are precise. 
We also exploit encoding composition to encode
\PHOpp into \HO and \sessp.
We consider the following 
typed calculi (cf.~\defref{d:tcalculus}):
\begin{enumerate}[-]
\item $\tyl{L}_{\HOpp}=\calc{\HOpp}{{\cal{T}}_4}{\hby{\ell}}{\hwb}{\proves}$,
where 
	${\cal{T}}_4$ is a set of types of $\HOpp$;  
the typing $\proves$ is defined in 
\figref{fig:typerulesmy} with extended rules \trule{Abs} and \trule{App}.

\item 
	$\tyl{L}_{\PHOp}=\calc{\PHOp}{{\cal{T}}_5}{\hby{\ell}}{\hwb}{\proves}$,
where 
	${\cal{T}}_5$ is the set of types of $\PHOp$;  
the typing $\proves$ is defined in
\figref{fig:typerulesmy} with polyadic types.
\end{enumerate}

%\myparagraph{Syntax, Operational Semantics and Types.}
%\noi First, the syntax of \figref{fig:syntax} extends 
%$\appl{V}{u}$ to 
% $\appl{V}{W}$, including higher-order value $W$. 
%The rule $\appl{(\abs{x}{P})}{V} \red P \subst{V}{x}$
%replaces
%rule $\orule{App}$ in \figref{fig:reduction}.
%The syntax of types is modified as follows: %changes to include: 
%\begin{center}
%\begin{tabular}{c}
%$L \bnfis \shot{U} \bnfbar \lhot{U}$
%\end{tabular}
%\end{center}
%These types can be easily accommodated in the type system:
% in \figref{fig:typerulesmy}, 
%we replace $C$ by $U$ in \trule{Abs} and $C$ by $U'$ in \trule{App}.
%\smallskip 
%
%\myparagraph{Behavioural Semantics.}
%Labels remain the same. Rule $\ltsrule{App}$ in the untyped LTS
%(\figref{fig:untyped_LTS}) 
%is replaced with rule $\appl{(\abs{x}{P})}{V} \by{\tau} P \subst{V}{x}$.
%\defref{def:char} (characteristic processes) is extended with  
%${\mapchar{\shot{U}}{x}} \defeq\! \mapchar{\lhot{U}}{x} \defeq\! {\appl{x}{\omapchar{U}}}$ and 
%${\omapchar{\shot{U}}} \defeq {\omapchar{\lhot{U}}} \!\!\defeq\!\! \abs{x}{\mapchar{U}{x}}$. 
%We can then use the same definitions for $\cong$, $\wbc$, $\hwb$ and $\fwb$. 
%\smallskip 

%\jparagraph{Encoding \HOpp into \HOp} 
First, the typed encoding
$\enco{\map{\cdot}^{3}, \mapt{\cdot}^{3}}: \HOpp \to \HOp$ is defined
in \figref{f:enc:hopip_to_hopi}.
It satisfies the following properties:

%HERE WE NEED TO ADD AN EXCERPT OF \propref{app:prop:op_corr_HOpp_to_HOp}, BUT WE NEED TO FIX MACROS FIRST.

\begin{proposition}[Operational Correspondence: From \HOpp to \HOp - Excerpt] %\myrm
	\label{prop:op_corr_HOpp_to_HOp}
	Let $P$ be an \HOpp process such that $\Gamma; \es; \Delta \proves P$.
	\begin{enumerate}[1.]
		\item	Completeness: 
			$\horel{\Gamma}{\Delta}{P}{\hby{\ell}}{\Delta'}{P'}$ implies
			\begin{enumerate}[a)]
%				\item	If $\ell \in \set{\news{\tilde{m}} \bactout{n}{\abs{x}{Q}}, \bactinp{n}{\abs{x}{Q}}}$ then
%%					$\exists l' $ such that
%					$\horel{\tmap{\Gamma}{3}}{\tmap{\Delta}{3}}{\pmap{P}{3}}{\hby{\ell'}}
%					{\tmap{\Delta'}{3}}{\pmap{P'}{3}}$ with $\mapa{\ell}^{3} = \ell'$.
%				\item	If $\ell \notin \set{\news{\tilde{m}} \bactout{n}{\abs{x}{Q}}, \bactinp{n}{\abs{x}{Q}}, \tau}$ then
%					$\horel{\tmap{\Gamma}{3}}{\tmap{\Delta}{3}}{\pmap{P}{3}}{\hby{\ell}}
%					{\tmap{\Delta'}{3}}{\pmap{P'}{3}}$.
%
				\item	If $\ell = \btau$ then
					$\horel{\tmap{\Gamma}{3}}{\tmap{\Delta}{3}}{\pmap{P}{3}}{\hby{\tau}}
					{\Delta''}{R}$ and
					$\horel{\tmap{\Gamma}{3}}{\tmap{\Delta'}{3}}{\pmap{P'}{3}}{\hwb}{\Delta''}{R}$, for some $R$;

				\item	If $\ell = \tau$ and $\ell \not= \btau$ then %and $\hby{\ell}$ is not a \betatran then
					$\horel{\tmap{\Gamma}{3}}{\tmap{\Delta}{3}}{\pmap{P}{3}}{\hby{\tau}}
					{\tmap{\Delta'}{3}}{\pmap{P'}{3}}$.
			\end{enumerate}

		\item Soundness: $\horel{\tmap{\Gamma}{3}}{\tmap{\Delta}{3}}{\pmap{P}{3}}{\hby{\tau}}
			{\tmap{\Delta''}{3}}{Q}$ implies either 
%
			\begin{enumerate}[a)]
%				\item	If $\ell \in \set{\news{\tilde{m}} \bactout{n}{\abs{x}{Q}}, \bactinp{n}{\abs{x}{Q}}, \tau}$
%					then
%					$\horel{\Gamma}{\Delta}{P}{\hby{\ell'}}{\Delta'}{P'}$
%%					and $\horel{\tmap{\Gamma}{3}}{\tmap{\Delta''}{3}}{Q}{\hby{\hat{\ell}}}{\tmap{\Delta'}{3}}{\pmap{P'}{3}}$
%					with $\mapa{\ell'}^{3} = \ell$ and $Q \scong \pmap{P'}{3}$.
%
%				\item	If $\ell \notin \set{\news{\tilde{m}} \bactout{n}{\abs{x}{R}}, \bactinp{n}{\abs{x}{R}}, \tau}$
%					then
%					$\horel{\Gamma}{\Delta}{P}{\hby{\ell}}{\Delta'}{P'}$ and $Q \scong \pmap{P'}{3}$.
%%					and $\horel{\tmap{\Gamma}{3}}{\tmap{\Delta''}{3}}{Q}{\hby{\hat{\ell}}}{\tmap{\Delta'}{3}}{\pmap{P'}{3}}$.
%
				\item	
					$\horel{\Gamma}{\Delta}{P}{\hby{\tau}}{\Delta'}{P'}$ with $Q \scong \pmap{P'}{3}$
				\item 
					$\horel{\Gamma}{\Delta}{P}{\hby{\btau}}{\Delta'}{P'}$ and
					$\horel{\tmap{\Gamma}{3}}{\tmap{\Delta''}{3}}{Q}{\hby{\btau}}
					{\tmap{\Delta''}{3}}{\pmap{P'}{3}}$.
			\end{enumerate}
	\end{enumerate}
\end{proposition}

\jp{
\begin{proposition}[\HOpp into \HOp: Type Preservation]
The encoding from $\tyl{L}_{\HOpp}$ into $\tyl{L}_{\HOp}$ (cf. \figref{f:enc:hopip_to_hopi})
is type preserving.
\end{proposition}}


\begin{proposition}[Full Abstraction. From \HOpp to \HOp]%\myrm
	%\label{app:prop:fulla_HOpp_to_HOp}
	Let $P, Q$ be \HOpp processes with $\Gamma; \es; \Delta_1 \proves P \hastype \Proc$ and 
	$\Gamma; \es; \Delta_2 \proves Q \hastype \Proc$. \\
	Then 
	$\horel{\Gamma}{\Delta_1}{P}{\hwb}{\Delta_2}{Q}$ if and only if $\horel{\tmap{\Gamma}{3}}{\tmap{\Delta_1}{3}}{\pmap{P}{3}}{\hwb}{\tmap{\Delta_2}{3}}{\pmap{Q}{3}}$
\end{proposition}

\input{figures/HOpp_to_HOp}

Using the above propositions,  
\thmsref{f:enc:hopitoho}
and 
\ref{f:enc:hotopi},
and \propref{pro:composition}, 
we derive the following: % theorem:

%\smallskip 

\begin{theorem}[Encoding \HOpp into~\HOp]
	\label{f:enc:hopiptohopi}
	The encoding from $\tyl{L}_{\HOpp}$ into $\tyl{L}_{\HOp}$ (cf. \figref{f:enc:hopip_to_hopi})
	is precise. Hence, the encodings 
	from $\tyl{L}_{\HOpp}$ to $\tyl{L}_{\HO}$ 
	and $\tyl{L}_{\sessp}$ 
	are also precise. 
\end{theorem}
%\smallskip 



%\noi Embeddings of polyadic name passing into monadic name passing are
%well-studied. % in the literature. 
%Using a linear typing, precise
%encodings (including full abstraction) can be obtained~\cite{Yoshida96}.
%Here we summarise how $\PHOp$ can be encoded into $\HOp$. 
%The syntax of 
%$\HOp$ is extended %from \HOp by including 
%with
%polyadic name passing $\tilde{n}$ and $\abs{\tilde{x}}{Q}$ in the syntax 
%of value $V$. The type syntax is extended to: 
%
%\begin{center}
%\begin{tabular}{c}
%$
%L ::= \shot{\tilde{C}} \ | \ \lhot{\tilde{C}}
%\quad\quad S \ ::= \  \btout{\tilde{U}} S \bnfbar \btinp{\tilde{U}} S \bnfbar \cdots 
%$
%\end{tabular}
%\end{center}
%%
%The type system disallows a shared name that directly carries polyadic
%shared names as in \cite{tlca07,MostrousY15}.
%i.e. $\chtype{\tilde{\chtype{S}}}$ 
%and $\chtype{\tilde{\chtype{L}}}$ 
%are disallowed.
%Other definitions are straightforwardly extended. 
%\jpc{We slightly modify \defref{def:tenc} to capture that a 
%label $\ell$ may be mapped into a sequence of labels~$\tilde{\ell}$.}
%We extend the mapping for labels 
%($\mapa{\cdot}: \ell \to \tilde{\ell}$ in  
%\defref{def:tenc}) to capture 
%a sequence of labels  and 
%Also, \defref{def:ep} is kept unchanged, 
%assuming that if 
%$P \hby{\ell} P'$ and $\mapa{\ell} = \ell_1, \ell_2,  \cdots, \ell_m$ then
%$\map{P} \Hby{\mapa{\ell}} \map{P'}$
%should be understood as
%$\map{P} \Hby{\ell_1} P_1 \Hby{\ell_2} P_2 \cdots \Hby{\ell_m} P_m =  \map{P'}$,
%for some
%$P_1, P_2, \ldots, P_m$.

%\jparagraph{Encoding $\PHOp$ into $\HOp$}
%\label{subsec:pho}
Second, we define the typed encoding
	$\enco{\map{\cdot}^{4}, \mapt{\cdot}^{4}}: \PHOp \to \HOp$ 
in \figref{f:enc:poltomon}.
For simplicity, we give the dyadic case (tuples of length 2);
the general case is as expected.
Then encoding of $\PHOp$  satisfies the following properties:

%HERE WE NEED TO ADD AN EXCERPT OF \propref{app:prop:op_corr_pHOp_to_HOp}, BUT WE NEED TO FIX MACROS FIRST.

\begin{proposition}[Operational Correspondence: From \PHOp to \HOp - Excerpt]\myrm
	\label{prop:op_corr_pHOp_to_HOp}
Let $\Gamma; \es; \Delta \proves P$.
	\begin{enumerate}[1.]
		\item	Completeness: 
			$\horel{\Gamma}{\Delta}{P}{\hby{\ell}}{\Delta'}{P'}$ implies
%
			\begin{enumerate}[a)]
%				\item	If $\ell = \news{\tilde{m}'} \bactout{n}{\tilde{m}}$ then
%					$\horel{\tmap{\Gamma}{4}}{\tmap{\Delta}{4}}{\pmap{P}{4}}{\hby{\ell_1} \dots \hby{\ell_n}}{\tmap{\Delta'}{4}}{\pmap{P}{4}}$
%					with $\mapa{\ell}^{4} = \ell_1 \dots \ell_n$.
%
%				\item	If $\ell = \bactinp{n}{\tilde{m}}$ then
%					$\horel{\tmap{\Gamma}{4}}{\tmap{\Delta}{4}}{\pmap{P}{4}}{\hby{\ell_1} \dots \hby{\ell_n}}{\tmap{\Delta'}{4}}{\pmap{P}{4}}$
%					with $\mapa{\ell}^{4} = \ell_1 \dots \ell_n$.
%
%				\item	If $\ell \in \set{\news{\tilde{m}} \bactout{n}{\abs{\tilde{x}}{R}}, \bactinp{n}{\abs{\tilde{x}}{R}}}$ then
%%					$\exists l' $ such that
%					$\horel{\tmap{\Gamma}{4}}{\tmap{\Delta}{4}}{\pmap{P}{4}}{\hby{\ell'}}
%					{\tmap{\Delta'}{4}}{\pmap{P'}{4}}$ with $\mapa{\ell}^{4} = \ell'$.
%
%				\item	If $\ell \in \set{\bactsel{n}{l}, \bactbra{n}{l}}$ then
%					$\horel{\tmap{\Gamma}{4}}{\tmap{\Delta}{4}}{\pmap{P}{4}}{\hby{\ell}}
%					{\tmap{\Delta'}{4}}{\pmap{P'}{4}}$.

				\item	If $\ell = \btau$ then %either
					$\horel{\tmap{\Gamma}{4}}{\tmap{\Delta}{4}}{\pmap{P}{4}}{\hby{\btau} \hby{\stau}  \hby{\stau}}
					{\tmap{\Delta'}{4}}{\pmap{P'}{4}}$ %with $\mapa{\ell} = \btau, \stau \dots \stau$.

				\item	If $\ell = \tau$ then %and $\hby{\ell}$ is not a \betatran then
					$\horel{\tmap{\Gamma}{4}}{\tmap{\Delta}{4}}{\pmap{P}{4}}{\hby{\tau}\hby{\tau} \hby{\tau}}
					{\tmap{\Delta'}{4}}{\pmap{P'}{4}}$ %with $\mapa{\ell}^{4} = \tau \dots \tau$.
			\end{enumerate}

		\item	%Let $\Gamma; \es; \Delta \proves P$.
		Soundness: 
			$\horel{\tmap{\Gamma}{4}}{\tmap{\Delta}{4}}{\pmap{P}{4}}{\hby{\ell}}
			{\tmap{\Delta_1}{4}}{P_1}$ implies
%
			\begin{enumerate}[a)]
%				\item	If $\ell \in \set{\bactinp{n}{m}, \bactout{n}{m}, \news{m} \bactout{n}{m}}$ then
%					$\horel{\Gamma}{\Delta}{P}{\hby{\ell}}{\Delta'}{P'}$ and\\
%					$\horel{\tmap{\Gamma}{4}}{\tmap{\Delta_1}{4}}{P_1}{\hby{\ell_2} \dots \hby{\ell_n}}
%					{\tmap{\Delta'}{4}}{\tmap{P'}{4}}$ with $\mapa{\ell}^{4} = \ell_1 \dots \ell_n$.
%
%				\item	If $\ell \in \set{\news{\tilde{m}} \bactout{n}{\abs{x}{R}}, \bactinp{n}{\abs{x}{R}}}$
%					then
%					$\horel{\Gamma}{\Delta}{P}{\hby{\ell'}}{\Delta'}{P'}$
%					with $\mapa{\ell'}^{4} = \ell$ and $P_1 \scong \pmap{P'}{4}$.
%
%				\item	If $\ell \in \set{\bactsel{n}{l}, \bactbra{n}{l}}$
%					then
%					$\horel{\Gamma}{\Delta}{P}{\hby{\ell}}{\Delta'}{P'}$ and $P_1 \scong \pmap{P'}{4}$.
%%					and $\horel{\tmap{\Gamma}{3}}{\tmap{\Delta''}{3}}{Q}{\hby{\hat{\ell}}}{\tmap{\Delta'}{3}}{\pmap{P'}{3}}$.
%
				\item	If $\ell = \btau$ then
					$\horel{\Gamma}{\Delta}{P}{\hby{\btau}}{\Delta'}{P'}$ and
					$\horel{\tmap{\Gamma}{4}}{\tmap{\Delta_1}{4}}{P_1}{\hby{\stau} \hby{\stau}}
					{\tmap{\Delta'}{4}}{\tmap{P'}{4}}$ %with $\mapa{\ell}^{4} = \btau, \stau \dots \stau$.

				\item	If $\ell = \tau$ then
					$\horel{\Gamma}{\Delta}{P}{\hby{\tau}}{\Delta'}{P'}$ and
					$\horel{\tmap{\Gamma}{4}}{\tmap{\Delta_1}{4}}{P_1}{\hby{\tau} \hby{\tau} \hby{\tau}}
					{\tmap{\Delta'}{4}}{\tmap{P'}{4}}$ %with $\mapa{\ell}^{4} = \tau \dots \tau$.
			\end{enumerate}
	\end{enumerate}
\end{proposition}

\jp{
\begin{proposition}[\PHOp into \HOp: Type Preservation]
The encoding from
		$\tyl{L}_{\PHOp}$ into $\tyl{L}_{\HOp}$ (cf. \figref{f:enc:poltomon})
is type preserving.
\end{proposition}}


\begin{proposition}[Full Abstraction: From \PHOp to \HOp]%\myrm
	%\label{app:prop:fulla_pHOp_to_HOp}
	Let $P, Q$ be \PHOp process with $\Gamma; \es; \Delta_1 \proves P \hastype \Proc$ and 
	$\Gamma; \es; \Delta_2 \proves Q \hastype \Proc$. Then we have: \\
	$\horel{\Gamma}{\Delta_1}{P}{\hwb}{\Delta_2}{Q}$ if and only if $\horel{\tmap{\Gamma}{4}}{\tmap{\Delta_1}{4}}{\pmap{P}{4}}{\hwb}{\tmap{\Delta_2}{4}}{\pmap{Q}{4}}$.
\end{proposition}

%Based on these propositions,we have:
Using the above propositions,  
\thmsref{f:enc:hopitoho}
and 
\ref{f:enc:hotopi},
and \propref{pro:composition}, 
we derive the following: 
\begin{theorem}[Encoding of \PHOp into \HOp]
	\label{f:enc:phopiptohopi}
	The encoding from
		$\tyl{L}_{\PHOp}$ into $\tyl{L}_{\HOp}$ (cf. \figref{f:enc:poltomon})
	is precise. 
	Hence, the encodings 
	from
	$\tyl{L}_{\PHOp}$ to $\tyl{L}_{\HO}$ 
	and $\tyl{L}_{\sessp}$ 
	are also precise. 
\end{theorem}
By combining Thms.~\ref{f:enc:hopiptohopi} and~\ref{f:enc:phopiptohopi},
we can extend preciseness to the super-calculus
$\PHOpp$.
% (denoted by   in Fig.~\ref{fig:express}) 


\input{figures/polHOp_to_HOp}
